---
title: "Felsöker rotering av krypteringsnyckel: [!DNL CVE-2024-34102]"
promoted: true
description: Använd en extra isolerad patch för att åtgärda ytterligare felsökning vid uppdatering av krypteringsnycklar från  [!DNL CVE-2024-34102] för Adobe Commerce 2.4.4-p8, 2.4.5-p7, 2.4.6-p5, 2.4.7 och tidigare versioner.
feature: Compliance, Security
role: Developer
source-git-commit: 46ac2d4307c73f22525302e363f5d0dc508780c7
workflow-type: tm+mt
source-wordcount: '822'
ht-degree: 0%

---

# Felsökning av krypteringsnyckelrotation: [!DNL CVE-2024-34102]

Den här artikeln är avsedd att hjälpa handlare att felsöka krypteringsnyckelrotation efter att de redan har följt de steg som beskrivs i den här [artikeln](https://experienceleague.adobe.com/en/docs/commerce-knowledge-base/kb/troubleshooting/known-issues-patches-attached/security-update-available-for-adobe-commerce-apsb24-40-revised-to-include-isolated-patch-for-cve-2024-34102) på [!DNL CVE-2024-34102].

Om du redan har följt stegen i artikeln ovan och har problem med att rotera dina krypteringsnycklar har vi en isolerad korrigering som hjälper dig att lösa eventuella problem.

För att illustrera de steg som tidigare har kommunicerats och sammanfattas ovan, för att skydda mot [!DNL CVE-2024-34102], samt den ytterligare felsökning som finns nedan, kan du även använda det här flödesdiagrammet:


![CVE-2024-34102 Protection Flow Chart.jpg](assets/cve-2024-34102-protection-flow-chart.jpg){zoomable="yes"}


## Använda den isolerade korrigeringen för att köra det nya kommandot

Zippa upp filen och se [Använda en kompositkorrigering från Adobe](https://experienceleague.adobe.com/docs/commerce-knowledge-base/kb/how-to/how-to-apply-a-composer-patch-provided-by-magento.html) i vår kunskapsbas för support för instruktioner.

## Lägga till en ny krypteringsnyckel utan att använda miljövariabler

Standardbeteendet för programmet är att lagra krypteringsnyckeln i filen `app/etc/env.php`.

De [steg som beskrivs i dokumentationen ](https://experienceleague.adobe.com/en/docs/commerce-admin/systems/security/encryption-key) beskriver hur du ändrar nyckeln i filen med hjälp av gränssnittet [!UICONTROL Admin].

Med hjälp av stegen och den isolerade korrigeringsfilen i det här avsnittet kan du enkelt ändra värdet i filen och du kan komma runt de problem som kan uppstå via [!UICONTROL Admin]-gränssnittet.

Det enklaste och säkraste sättet att hantera krypteringsnyckeln är att använda miljövariabler. Om du redan använder miljövariabler, eller är intresserad av att använda dem för att hantera nyckeln i stället, finns det ett separat avsnitt som beskriver dessa steg.

## Berörda produkter och versioner

Adobe Commerce i molnet, Adobe Commerce lokalt och Magento Open Source:

* 2.4.7-p1 och tidigare versioner
* 2.4.6-p6 och tidigare
* 2.4.5-p8 och tidigare
* 2.4.4-p9 och tidigare

## Isolerad korrigering för felsökning av rotationsinformation för krypteringsnyckel

Använd följande bifogade patchar, beroende på vilken version av Adobe Commerce/Magento Open Source du använder:

### För version 2.4.7, 2.4.7-p1:

* [ac-12589-2.4.7x-composer-patch.zip](assets/ac-12589-2.4.7x-composer-patch.zip)

### För version 2.4.6, 2.4.6-p1, 2.4.6-p2, 2.4.6-p3, 2.4.6-p4, 2.4.6-p5, 2.4.6-p6:

* [ac-12589-2.4.6x-composer-patch.zip](assets/ac-12589-2.4.6x-composer-patch.zip)

### För version 2.4.5, 2.4.5-p1, 2.4.5-p2, 2.4.5-p3, 2.4.5-p4, 2.4.5-p5, 2.4.5-p6, 2.4.5-p7, 2.4.5-p8:

* [ac-12589-2.4.5x_COMPOSER_patch.zip](assets/ac-12589-2.4.5x-composer-patch.zip)

### För version 2.4.4, 2.4.4-p1, 2.4.4-p2, 2.4.4-p3, 2.4.4-p4, 2.4.4-p5, 2.4.4-p6, 2.4.4-p7, 2.4.4-p8, 2.4.4-p9:

* [ac-12589-2.4.4x-comser-patch.zip](assets/ac-12589-2.4.4x-composer-patch.zip)


När du har installerat den isolerade korrigeringen ändrar du den aktiva krypteringsnyckeln med det nya [!DNL CLI]-kommandot.

>[!NOTE]
>
>**Det nya [!DNL CLI]-kommandot utlöser en rensning av cachen vid körning.**

1. Det nya kommandot bör köras i miljön som innehåller din `app/etc/env.php`-fil för nyckeln som du vill uppdatera.
1. Bekräfta att det nya kommandot finns:

   ```
   bin/magento list | grep encryption:key:change
   ```

   Följande utdata bör visas:

   ```
   encryption:key:change Change the encryption key inside the env.php file.
   ```

1. Ändra krypteringsnyckeln:

   ```
   bin/magento encryption:key:change
   ```

1. Om du har utfört det här kommandot i produktionssystemet behöver du inte utföra någon ytterligare åtgärd.
Om du har kört detta på ett utvecklingssystem måste **du** få in den här ändringen i produktionssystemet på samma sätt som du vanligtvis distribuerar känsliga konfigurationsinställningar.

## Uppdatera krypteringsnyckeln med hjälp av miljövariabler i stället för att använda den isolerade korrigeringen

Som ett alternativ till avsnittet ovan kan du med de här stegen lägga till en ny krypteringsnyckel samtidigt som du bevarar dina befintliga krypterade data, även om du använder standardvärdet `app/etc/env.php`.
**Det här avsnittet gäller för Adobe Commerce i molnet och Cloud Starter, men gäller även för Adobe Commerce lokalt**, även om de exakta stegen och platserna för variablerna beror på din infrastruktur.

### Samla in aktuellt värde

* Om du redan hanterar dina nycklar med miljövariabler kan det finnas på [flera möjliga platser](https://experienceleague.adobe.com/en/docs/commerce-cloud-service/user-guide/configure/env/stage/variables-intro), men troligen i variabeln [`CRYPT_KEY`](https://experienceleague.adobe.com/en/docs/commerce-cloud-service/user-guide/configure/env/stage/variables-deploy#crypt_key) enligt beskrivningen i dokumentationen.
* Om du inte använder variabler kommer krypteringsnyckeln att finnas i `app/etc/env.php` i `crypt/key`-datanyckeln.

I båda fallen kan det vara ett flerradsvärde och innehålla flera objekt som har prefixet `base64`.

### Generera en ny nyckel

Krypteringsnycklar är 32 byte slumpmässiga data som är kodade med [!DNL base64] och prefix med `base64`.
Så här skapar du en ny nyckel:

1. Generera 32 slumpmässiga databyte som är kodade med [!DNL base64] med det verktyg du väljer. Med [!DNL OpenSSL CLI] kan du till exempel köra `openssl rand -base64 32`, men du kan använda ett pålitligt kryptografiskt slumpmässigt genereringsverktyg.
1. Använd `base64` som prefix för det värdet. Om till exempel kommandot `openssl` returnerar *ABC123* blir värdet: *base64ABC123*

### Skapa det nya värdet

Lägg till det genererade värdet i det befintliga värdet som du har samlat in ovan. Om ditt befintliga värde till exempel är *base64HelloWorld* blir ditt nya värde:<br>

```
base64ABC123
base64HelloWorld
```

### Lägg till en ny miljövariabel

Använd [[!UICONTROL Cloud Console] eller  [!DNL magento-cloud CLI]](https://experienceleague.adobe.com/en/docs/commerce-cloud-service/user-guide/configure/env/variable-levels) för att ange `env:MAGENTO_DC_CRYPT__KEY` [miljövariabeln ](https://experienceleague.adobe.com/en/docs/commerce-cloud-service/user-guide/configure/env/stage/variables-cloud) till det nya värdet.

>[!NOTE]
>
>Observera att om du väljer att markera variabeln som *känslig* kanske du vill spara en extern säkerhetskopia av det här värdet, eftersom det döljs från alla gränssnitt och bara är synligt för programmet.

När du sparar variabeln aktiveras en omdistribution automatiskt, vilket gör att värdet används.

## Säkerhetsuppdateringar

Relaterade säkerhetsuppdateringar för Adobe Commerce:

* [Säkerhetsuppdatering för Adobe Commerce - APSB24-40](https://experienceleague.adobe.com/en/docs/commerce-knowledge-base/kb/troubleshooting/known-issues-patches-attached/security-update-available-for-adobe-commerce-apsb24-40-revised-to-include-isolated-patch-for-cve-2024-34102)
* [Säkerhetsbulletin för Adobe ([!DNL APSB24-40])](https://helpx.adobe.com/security/products/magento/apsb24-40.html)
